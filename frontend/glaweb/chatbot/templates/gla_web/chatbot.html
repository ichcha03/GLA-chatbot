<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %} {% csrf_token %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GLA University Chatbot - AI Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Sans+Devanagari:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-green: #006400;
        --light-green: #dbffe0;
        --lighter-green: #f9fdf9;
        --bg-gradient: linear-gradient(135deg, #e6ffe6 0%, #f2fff5 100%);
        --text-primary: #1a3e1a;
        --text-secondary: #333;
        --text-light: #666;
        --white: #ffffff;
        --glass-bg: rgba(255, 255, 255, 0.85);
        --shadow: 0 8px 32px rgba(0, 100, 0, 0.15);
        --shadow-hover: 0 12px 40px rgba(0, 100, 0, 0.25);
        --border-radius: 24px;
        --transition: all 0.3s ease;
      }

      body {
        font-family: "Inter", "Noto Sans", "Noto Sans Devanagari", "Segoe UI",
          sans-serif;
        background: var(--bg-gradient);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        overflow-x: hidden;
        position: relative;
      }

      /* Watermark */
      body::before {
        content: "GLA University";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
          45deg,
          transparent,
          transparent 100px,
          rgba(0, 100, 0, 0.05) 100px,
          rgba(0, 100, 0, 0.05) 200px
        );
        background-size: 200px 200px;
        color: rgba(0, 100, 0, 0.1);
        font-size: 40px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 5px;
        pointer-events: none;
        z-index: -1;
      }

      .chat-container {
        width: 100%;
        max-width: 900px;
        height: 85vh;
        max-height: 750px;
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        border: 2px solid var(--primary-green);
        box-shadow: var(--shadow);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
        animation: slideUp 0.8s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .chat-header {
        background: var(--primary-green);
        padding: 20px 28px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
      }

      .chat-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
        z-index: 2;
      }

      .logo {
        width: 70px;
        height: 70px;
        border-radius: 12px;
        object-fit: contain;
        border: 2px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        background: var(--white);
        padding: 5px;
      }

      .header-title {
        display: flex;
        flex-direction: column;
      }

      .header-title h1 {
        font-size: 22px;
        font-weight: 700;
        color: var(--white);
        margin-bottom: 3px;
        letter-spacing: -0.3px;
      }

      .header-title .subtitle {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.85);
        font-weight: 400;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
        z-index: 2;
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #00ff88;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(1.2);
        }
      }

      .status-text {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 500;
      }

      .chat-box {
        flex: 1;
        overflow-y: auto;
        padding: 28px;
        background: var(--lighter-green);
        background-image: radial-gradient(
            circle at 10% 20%,
            rgba(0, 100, 0, 0.05) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 90% 80%,
            rgba(0, 100, 0, 0.03) 0%,
            transparent 50%
          );
        background-repeat: no-repeat;
        background-position: center;
        background-size: cover;
        display: flex;
        flex-direction: column;
        gap: 16px;
        position: relative;
      }

      .chat-box::-webkit-scrollbar {
        width: 8px;
      }

      .chat-box::-webkit-scrollbar-track {
        background: transparent;
      }

      .chat-box::-webkit-scrollbar-thumb {
        background: rgba(0, 100, 0, 0.3);
        border-radius: 4px;
      }

      .chat-box::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 100, 0, 0.5);
      }

      .welcome-message {
        text-align: center;
        padding: 32px 16px;
        color: var(--text-light);
        animation: fadeIn 1s ease-out 0.5s both;
      }

      .welcome-message i {
        font-size: 40px;
        margin-bottom: 12px;
        color: var(--primary-green);
      }

      .welcome-message h3 {
        font-size: 18px;
        margin-bottom: 6px;
        color: var(--text-primary);
        font-weight: 600;
      }

      .welcome-message p {
        font-size: 14px;
        line-height: 1.5;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .chat-bubble {
        max-width: 80%;
        padding: 14px 18px;
        border-radius: 16px;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
        animation: messageSlide 0.4s ease-out;
        word-wrap: break-word;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      @keyframes messageSlide {
        from {
          opacity: 0;
          transform: translateY(15px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .chat-bubble.user {
        align-self: flex-end;
        background: var(--light-green);
        color: var(--text-primary);
        border-bottom-right-radius: 6px;
      }

      .chat-bubble.bot {
        align-self: flex-start;
        background: var(--glass-bg);
        color: var(--text-secondary);
        border-bottom-left-radius: 6px;
        border: 1px solid rgba(0, 100, 0, 0.15);
      }

      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 12px 16px;
        background: var(--glass-bg);
        border-radius: 16px;
        border-bottom-left-radius: 6px;
        max-width: 70%;
        border: 1px solid rgba(0, 100, 0, 0.15);
        animation: messageSlide 0.4s ease-out;
      }

      .typing-dots {
        display: flex;
        gap: 5px;
      }

      .typing-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--primary-green);
        animation: typing 1.2s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.5;
        }
        30% {
          transform: translateY(-8px);
          opacity: 1;
        }
      }

      .chat-input {
        padding: 20px 28px;
        background: var(--glass-bg);
        border-top: 1px solid rgba(0, 100, 0, 0.15);
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .input-wrapper {
        flex: 1;
        position: relative;
      }

      .chat-input input {
        width: 100%;
        padding: 14px 18px;
        background: var(--lighter-green);
        border: 1px solid rgba(0, 100, 0, 0.2);
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 14px;
        outline: none;
        transition: var(--transition);
        font-family: inherit;
      }

      .chat-input input:focus {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 3px rgba(0, 100, 0, 0.15);
      }

      .chat-input input::placeholder {
        color: var(--text-light);
        font-style: italic;
      }

      .voice-button,
      .send-button {
        padding: 14px;
        border-radius: 12px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 48px;
        height: 48px;
      }

      .voice-button {
        background: var(--lighter-green);
        color: var(--primary-green);
        border: 1px solid rgba(0, 100, 0, 0.2);
        font-size: 16px;
      }

      .voice-button:hover {
        background: var(--primary-green);
        color: var(--white);
        transform: translateY(-2px) scale(1.05);
        box-shadow: var(--shadow-hover);
      }

      .voice-button.recording {
        background: #ff4444;
        color: var(--white);
        animation: recordingPulse 1s infinite;
      }

      @keyframes recordingPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
      }

      .send-button {
        background: var(--primary-green);
        color: var(--white);
        border: none;
        font-weight: 600;
        font-size: 14px;
        gap: 6px;
        box-shadow: 0 4px 12px rgba(0, 100, 0, 0.3);
      }

      .send-button:hover {
        background: #0a7c0a;
        transform: translateY(-2px) scale(1.05);
        box-shadow: var(--shadow-hover);
      }

      .send-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(0, 100, 0, 0.2);
      }

      .send-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .quick-actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .quick-action {
        padding: 10px 18px;
        background: var(--glass-bg);
        border: 1px solid rgba(0, 100, 0, 0.15);
        border-radius: 16px;
        color: var(--text-primary);
        font-size: 13px;
        cursor: pointer;
        transition: var(--transition);
        animation: fadeIn 0.5s ease-out;
      }

      .quick-action:hover {
        background: var(--primary-green);
        color: var(--white);
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
      }

      .message-time {
        font-size: 11px;
        color: var(--text-light);
        margin-top: 4px;
        opacity: 0.8;
      }

      .voice-status {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.85);
        color: var(--white);
        padding: 16px 24px;
        border-radius: 12px;
        display: none;
        text-align: center;
        z-index: 1000;
        box-shadow: var(--shadow);
      }

      .voice-status.show {
        display: flex;
        flex-direction: column;
        gap: 8px;
        animation: fadeIn 0.3s ease-out;
      }

      .sub-topics {
        margin-top: 12px;
        padding: 16px;
        background: var(--glass-bg);
        border-radius: 16px;
        border: 1px solid rgba(0, 100, 0, 0.15);
        animation: slideIn 0.4s ease-out;
      }

      .sub-topic-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(0, 100, 0, 0.1);
      }

      .back-btn {
        background: var(--lighter-green);
        color: var(--primary-green);
        border: 1px solid rgba(0, 100, 0, 0.2);
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 13px;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .back-btn:hover {
        background: var(--primary-green);
        color: var(--white);
        transform: translateX(-2px);
      }

      .sub-topic-header h4 {
        color: var(--text-primary);
        font-size: 16px;
        margin: 0;
        font-weight: 600;
      }

      .sub-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .sub-actions .quick-action {
        background: var(--lighter-green);
        border: 1px solid rgba(0, 100, 0, 0.15);
        font-size: 12px;
        padding: 8px 14px;
      }

      .sub-actions .quick-action:hover {
        background: var(--primary-green);
        color: var(--white);
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 768px) {
        .chat-container {
          height: 95vh;
          margin: 8px;
          border-radius: 16px;
        }

        .chat-header {
          padding: 16px;
        }

        .header-title h1 {
          font-size: 18px;
        }

        .header-title .subtitle {
          font-size: 12px;
        }

        .logo {
          width: 60px;
          height: 60px;
          border-width: 1px;
        }

        .chat-box {
          padding: 16px;
        }

        .chat-bubble {
          max-width: 90%;
          font-size: 13px;
          padding: 12px 16px;
        }

        .chat-input {
          padding: 16px;
          gap: 8px;
        }

        .chat-input input {
          font-size: 13px;
          padding: 12px 16px;
        }

        .voice-button,
        .send-button {
          min-width: 44px;
          height: 44px;
          font-size: 13px;
        }

        .quick-action {
          font-size: 12px;
          padding: 8px 14px;
        }

        .sub-topics {
          padding: 12px;
        }

        .sub-topic-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 6px;
        }

        .sub-topic-header h4 {
          font-size: 15px;
        }

        .sub-actions .quick-action {
          font-size: 11px;
          padding: 8px 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <div class="header-left">
          <img
            src="{% static 'gla_web/image/gla-logo.jpg' %}"
            alt="GLA University Logo"
            class="logo"
          />
          <div class="header-title">
            <h1>GLA University Assistant</h1>
            <div class="subtitle">AI-powered university support</div>
          </div>
        </div>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span class="status-text">Online</span>
        </div>
      </div>

      <div class="chat-box" id="chat-box">
        <div class="welcome-message">
          <i class="fas fa-robot"></i>
          <h3>Welcome to GLA University Assistant!</h3>
          <p>
            Ask me anything about GLA University‚Äîadmissions, fees, placements,
            facilities, or campus life‚Äîin any language!
          </p>
          <div class="quick-actions" id="main-topics">
            <div class="quick-action" onclick="showSubTopics('admissions')">
              üéì Admissions
            </div>
            <div class="quick-action" onclick="showSubTopics('academics')">
              üìö Academics
            </div>
            <div class="quick-action" onclick="showSubTopics('fees')">
              üí∞ Fees & Scholarships
            </div>
            <div class="quick-action" onclick="showSubTopics('placements')">
              üéØ Placements
            </div>
            <div class="quick-action" onclick="showSubTopics('facilities')">
              üè¢ Facilities
            </div>
            <div class="quick-action" onclick="showSubTopics('campus')">
              üå≥ Campus Life
            </div>
            <div class="quick-action" onclick="showSubTopics('others')">
              ‚ûï Others
            </div>
          </div>
          <div
            class="sub-topics"
            id="admissions-subtopics"
            style="display: none"
          >
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>üéì Admissions</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the eligibility criteria for B.Tech?')"
              >
                üìã Eligibility Criteria
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('How to apply for admission?')"
              >
                üìù Application Process
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the entrance exams accepted?')"
              >
                üìä Entrance Exams
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the important admission dates?')"
              >
                üìÖ Important Dates
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about document verification process')"
              >
                üìÑ Document Verification
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What is the admission counselling process?')"
              >
                üó£Ô∏è Counselling
              </div>
            </div>
          </div>
          <div
            class="sub-topics"
            id="academics-subtopics"
            style="display: none"
          >
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>üìö Academics</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the B.Tech specializations available?')"
              >
                üîß B.Tech Programs
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about MBA programs')"
              >
                üíº MBA Programs
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the M.Tech specializations?')"
              >
                üéì M.Tech Programs
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about the examination system')"
              >
                üìù Examinations
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What is the grading system?')"
              >
                üìä Grading System
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about faculty and teaching methods')"
              >
                üë®‚Äçüè´ Faculty & Teaching
              </div>
            </div>
          </div>
          <div class="sub-topics" id="fees-subtopics" style="display: none">
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>üí∞ Fees & Scholarships</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the fees for B.Tech?')"
              >
                üí∞ B.Tech Fees
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about MBA fees structure')"
              >
                üí≥ MBA Fees
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What scholarships are available?')"
              >
                üèÜ Scholarships
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about fee payment options')"
              >
                üí∏ Payment Options
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the additional charges?')"
              >
                üìã Additional Charges
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about fee refund policy')"
              >
                üîÑ Refund Policy
              </div>
            </div>
          </div>
          <div
            class="sub-topics"
            id="placements-subtopics"
            style="display: none"
          >
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>üéØ Placements</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about placement statistics')"
              >
                üìä Placement Statistics
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Who are the top recruiters?')"
              >
                üè¢ Top Recruiters
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What is the average package offered?')"
              >
                üí∞ Package Details
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about internship opportunities')"
              >
                üîó Internships
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('How does the placement cell work?')"
              >
                üéØ Placement Cell
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What is the placement preparation process?')"
              >
                üìö Placement Preparation
              </div>
            </div>
          </div>
          <div
            class="sub-topics"
            id="facilities-subtopics"
            style="display: none"
          >
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>üè¢ Facilities</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('Hostel facilities and fees')"
              >
                üè† Hostel Facilities
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about library facilities')"
              >
                üìö Library
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the laboratory facilities?')"
              >
                üî¨ Laboratories
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about sports facilities')"
              >
                ‚öΩ Sports Facilities
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What medical facilities are available?')"
              >
                üè• Medical Facilities
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about IT infrastructure')"
              >
                üíª IT Infrastructure
              </div>
            </div>
          </div>
          <div class="sub-topics" id="campus-subtopics" style="display: none">
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>üå≥ Campus Life</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about student clubs and societies')"
              >
                üé≠ Clubs & Societies
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What cultural events are organized?')"
              >
                üé™ Cultural Events
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about technical fests')"
              >
                üîß Technical Fests
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the mess and canteen facilities?')"
              >
                üçΩÔ∏è Food & Dining
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about transportation facilities')"
              >
                üöå Transportation
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What security measures are in place?')"
              >
                üîí Security
              </div>
            </div>
          </div>
          <div class="sub-topics" id="others-subtopics" style="display: none">
            <div class="sub-topic-header">
              <button onclick="showMainTopics()" class="back-btn">
                ‚Üê Back
              </button>
              <h4>‚ûï Others</h4>
            </div>
            <div class="sub-actions">
              <div
                class="quick-action"
                onclick="sendQuickMessage('What is the university ranking?')"
              >
                üèÜ Rankings
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about alumni network')"
              >
                üë• Alumni Network
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What are the university affiliations?')"
              >
                üîó Affiliations
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('Tell me about research opportunities')"
              >
                üî¨ Research
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('What international programs are available?')"
              >
                üåç International Programs
              </div>
              <div
                class="quick-action"
                onclick="sendQuickMessage('How to contact the university?')"
              >
                üìû Contact Information
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-input">
        <div class="input-wrapper">
          <input
            type="text"
            id="user-input"
            placeholder="Type your message in any language... | ‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•á‡§Ç ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç..."
          />
        </div>
        <button class="voice-button" id="voice-btn">
          <i class="fas fa-microphone"></i>
        </button>
        <button class="send-button" id="send-btn">
          <i class="fas fa-paper-plane"></i>
          Send
        </button>
      </div>

      <div class="voice-status" id="voice-status">
        <i class="fas fa-microphone fa-2x"></i>
        <p id="voice-status-text">Listening...</p>
      </div>
    </div>

    <script>
      let messageCount = 0;
      let isRecording = false;
      let recognition = null;

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      function showSubTopics(topicId) {
        const mainTopics = document.getElementById("main-topics");
        if (mainTopics) {
          mainTopics.style.display = "none";
        } else {
          console.error("Element with ID 'main-topics' not found");
        }

        // Hide all sub-topics
        document.querySelectorAll(".sub-topics").forEach((subTopic) => {
          subTopic.style.display = "none";
        });

        // Show selected sub-topic
        const selectedSubTopic = document.getElementById(
          topicId + "-subtopics"
        );
        if (selectedSubTopic) {
          selectedSubTopic.style.display = "block";
        } else {
          console.error(`Element with ID '${topicId}-subtopics' not found`);
          if (mainTopics) mainTopics.style.display = "flex";
        }

        // Scroll to bottom
        const chatBox = document.getElementById("chat-box");
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function showMainTopics() {
        document.querySelectorAll(".sub-topics").forEach((subTopic) => {
          subTopic.style.display = "none";
        });
        document.getElementById("main-topics").style.display = "flex";
        const chatBox = document.getElementById("chat-box");
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function sendQuickMessage(message) {
        const inputField = document.getElementById("user-input");
        inputField.value = message;
        sendMessage();
      }

      async function sendMessage() {
        const inputField = document.getElementById("user-input");
        const userMessage = inputField.value.trim();
        if (!userMessage) return;

        const chatBox = document.getElementById("chat-box");
        const sendBtn = document.getElementById("send-btn");

        // Remove welcome message if it exists
        const welcomeMessage = chatBox.querySelector(".welcome-message");
        if (welcomeMessage) {
          welcomeMessage.style.animation = "fadeOut 0.3s ease-out forwards";
          setTimeout(() => welcomeMessage.remove(), 300);
        }

        // Add user's message
        const userBubble = document.createElement("div");
        userBubble.className = "chat-bubble user";
        userBubble.innerHTML = `
          ${userMessage}
          <div class="message-time">${getCurrentTime()}</div>
        `;
        chatBox.appendChild(userBubble);
        inputField.value = "";

        // Scroll to bottom
        chatBox.scrollTop = chatBox.scrollHeight;

        // Show typing indicator
        const typingIndicator = document.createElement("div");
        typingIndicator.className = "typing-indicator";
        typingIndicator.innerHTML = `
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
          <span style="color: var(--text-light); font-size: 13px;">Assistant is typing...</span>
        `;
        chatBox.appendChild(typingIndicator);
        chatBox.scrollTop = chatBox.scrollHeight;

        try {
          // Send query to backend
          const response = await fetch("/chat/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-CSRFToken": getCookie("csrftoken"),
            },
            body: JSON.stringify({ question: userMessage }),
          });

          const data = await response.json();
          typingIndicator.remove();

          // Add bot's response
          const botBubble = document.createElement("div");
          botBubble.className = "chat-bubble bot";
          botBubble.innerHTML = `
            ${data.answer}
            <div class="message-time">${getCurrentTime()}</div>
          `;
          chatBox.appendChild(botBubble);
          chatBox.scrollTop = chatBox.scrollHeight;

          // Re-enable send button
          sendBtn.disabled = false;
        } catch (error) {
          console.error("Error:", error);
          typingIndicator.remove();
          const errorBubble = document.createElement("div");
          errorBubble.className = "chat-bubble bot";
          errorBubble.innerHTML = `
            Sorry, something went wrong. Please try again.
            <div class="message-time">${getCurrentTime()}</div>
          `;
          chatBox.appendChild(errorBubble);
          chatBox.scrollTop = chatBox.scrollHeight;
          sendBtn.disabled = false;
        }
      }

      function getCurrentTime() {
        const now = new Date();
        return now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }

      // Initialize speech recognition
      if (
        "webkitSpeechRecognition" in window ||
        "SpeechRecognition" in window
      ) {
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "en-US"; // Default to English

        recognition.onstart = function () {
          isRecording = true;
          const voiceBtn = document.getElementById("voice-btn");
          const voiceStatus = document.getElementById("voice-status");
          voiceBtn.classList.add("recording");
          voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
          voiceStatus.classList.add("show");
          document.getElementById("voice-status-text").textContent =
            "Listening...";
        };

        recognition.onresult = function (event) {
          const transcript = event.results[0][0].transcript;
          document.getElementById("user-input").value = transcript;
          document.getElementById("voice-status-text").textContent =
            "Processing...";
          setTimeout(() => {
            sendMessage();
          }, 500);
        };

        recognition.onerror = function (event) {
          console.error("Speech recognition error:", event.error);
          document.getElementById("voice-status-text").textContent =
            "Error occurred. Please try again.";
          setTimeout(stopVoiceInput, 2000);
        };

        recognition.onend = function () {
          stopVoiceInput();
        };
      }

      function detectLanguageForVoice(text) {
        // Hindi/Devanagari script detection
        if (/[\u0900-\u097F]/.test(text)) return "hi-IN";
        // Arabic script detection
        if (/[\u0600-\u06FF]/.test(text)) return "ar-SA";
        // Chinese characters detection
        if (/[\u4e00-\u9fff]/.test(text)) return "zh-CN";
        // Japanese characters detection
        if (/[\u3040-\u309f\u30a0-\u30ff]/.test(text)) return "ja-JP";
        // Korean characters detection
        if (/[\uac00-\ud7af]/.test(text)) return "ko-KR";
        // Spanish detection (basic)
        if (/[√±√°√©√≠√≥√∫√º]/.test(text.toLowerCase())) return "es-ES";
        // French detection (basic)
        if (/[√†√¢√§√©√®√™√´√Ø√Æ√¥√π√ª√º√ø√ß]/.test(text.toLowerCase())) return "fr-FR";
        // German detection (basic)
        if (/[√§√∂√º√ü]/.test(text.toLowerCase())) return "de-DE";
        return "en-US"; // Default to English
      }

      function toggleVoiceInput() {
        if (!recognition) {
          alert(
            "Speech recognition is not supported in your browser. Please try Chrome or Safari."
          );
          return;
        }

        // Dynamically set language based on input content or last message
        const inputField = document.getElementById("user-input").value.trim();
        const chatMessages = document.querySelectorAll(".chat-bubble.user");
        const lastMessage =
          chatMessages.length > 0
            ? chatMessages[chatMessages.length - 1].textContent
            : "";

        // Detect language from current input or last message
        const textToAnalyze = inputField || lastMessage;
        recognition.lang = detectLanguageForVoice(textToAnalyze);

        console.log(`Voice recognition language set to: ${recognition.lang}`);

        if (isRecording) {
          recognition.stop();
        } else {
          recognition.start();
        }
      }

      function stopVoiceInput() {
        isRecording = false;
        const voiceBtn = document.getElementById("voice-btn");
        const voiceStatus = document.getElementById("voice-status");
        voiceBtn.classList.remove("recording");
        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceStatus.classList.remove("show");
      }

      // Add event listeners after DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("user-input")
          .addEventListener("keypress", handleKeyPress);
        document
          .getElementById("voice-btn")
          .addEventListener("click", toggleVoiceInput);
        document
          .getElementById("send-btn")
          .addEventListener("click", sendMessage);
      });

      // Add CSS for fadeOut animation
      const style = document.createElement("style");
      style.textContent = `
        @keyframes fadeOut {
          from { opacity: 1; transform: translateY(0); }
          to { opacity: 0; transform: translateY(-20px); }
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
